version: '3.8'

services:
  tesla_local_control_addon:
    container_name: tesla_local_control_addon
    image: tesla_local_control_addon:0.0.8dev

### THIS DOESN'T WORK ... maybe the double quotes aren't needed?
### This logic is now in run.sh BUT it would be nicer somehow to have it in here.
#    entrypoint: "[ -L /command/with-contenv ] \
#                  && /app/run.sh \
#                  || /usr/bin/sh /app/run.sh"

    env_file:
      - ./env

    network_mode: host
    privileged: true

    restart: no
    #restart: unless-stopped

    stdin_open: true
    tty: true

    volumes:
      - data:/data
      - share:/share/tesla_ble_mqtt
      - /run/dbus:/run/dbus

    working_dir: /data

volumes:
  data:
  share:
